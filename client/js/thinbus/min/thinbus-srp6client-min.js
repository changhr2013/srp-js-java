function SRP6JavascriptClientSession(){this.INIT=0;this.STEP_1=1;this.STEP_2=2;this.STEP_3=3;this.state=this.INIT;this.x=null;this.v=null;this.I=null;this.P=null;this.salt=null;this.B=null;this.A=null;this.a=null;this.k=null;this.u=null;this.S=null;this.K=null;this.M1str=null;this.check=function(a,b){if(typeof a==="undefined"||a===null||a===""||a==="0"){throw new Error(b+" must not be null, empty or zero")}};this.generateX=function(c,a,b){this.check(c,"salt");this.check(a,"identity");this.check(b,"password");this.salt=c;var f=this.H(a+":"+b);while(f.substring(0,1)==="0"){f=f.substring(1)}var e=(c+f).toUpperCase();var d=this.H(e);while(d.substring(0,1)==="0"){d=d.substring(1)}this.x=this.fromHex(d).mod(this.N());return this.x};this.computeSessionKey=function(d,b,e,c,h){this.check(d,"k");this.check(b,"x");this.check(e,"u");this.check(c,"a");this.check(h,"B");var g=e.multiply(b).add(c);var f=this.g().modPow(b,this.N()).multiply(d);return h.subtract(f).modPow(g,this.N())}}SRP6JavascriptClientSession.prototype.toHex=function(a){return a.toString(16)};SRP6JavascriptClientSession.prototype.fromHex=function(a){return new BigInteger(""+a,16)};SRP6JavascriptClientSession.prototype.BigInteger=function(a,b){return new BigInteger(""+a,b)};SRP6JavascriptClientSession.prototype.getState=function(){return this.state};SRP6JavascriptClientSession.prototype.getSessionKey=function(a){if(this.S===null){return null}this.SS=this.toHex(this.S);if(typeof a!=="undefined"&&a===false){return this.SS}else{if(this.K===null){this.K=this.H(this.SS)}return this.K}};SRP6JavascriptClientSession.prototype.getUserID=function(){return this.I};SRP6JavascriptClientSession.prototype.generateRandomSalt=function(a){var c=null;c=random16byteHex.random();var b=this.H((new Date())+":"+a+":"+c);return b};SRP6JavascriptClientSession.prototype.generateVerifier=function(d,b,c){var a=this.generateX(d,b,c);this.v=this.g().modPow(a,this.N());return this.toHex(this.v)};SRP6JavascriptClientSession.prototype.step1=function(a,b){this.check(a,"identity");this.check(b,"password");this.I=a;this.P=b;if(this.state!==this.INIT){throw new Error("IllegalStateException not in state INIT")}this.state=this.STEP_1};SRP6JavascriptClientSession.prototype.computeU=function(a,d){this.check(a,"Astr");this.check(d,"Bstr");var b=this.H(a+d);var c=new BigInteger(""+b,16);if(BigInteger.ZERO.equals(c)){throw new Error("SRP6Exception bad shared public value 'u' as u==0")}return c};SRP6JavascriptClientSession.prototype.random16byteHex=function(){var a=null;a=random16byteHex.random();return a};SRP6JavascriptClientSession.prototype.randomA=function(f){var c=this.toHex(f).length;var a=this.BigInteger("0",10);var b=this.BigInteger("1",10);var d=a;while(a.equals(d)){var e=this.random16byteHex()+this.random16byteHex();while(e.length<c){e=e+this.random16byteHex()}var h=this.BigInteger(e,16);var g=this.BigInteger(this.H(this.I+":"+this.salt+":"+(new Date()).getTime()),16);d=(g.add(h)).modPow(b,f)}return d};SRP6JavascriptClientSession.prototype.step2=function(c,e){this.check(c,"s");this.check(e,"BB");if(this.state!==this.STEP_1){throw new Error("IllegalStateException not in state STEP_1")}this.B=this.fromHex(e);var b=null;b=BigInteger.ZERO;if(this.B.mod(this.N()).equals(b)){throw new Error("SRP6Exception bad server public value 'B' as B == 0 (mod N)")}var a=this.generateX(c,this.I,this.P);this.P=null;this.a=this.randomA(this.N);this.A=this.g().modPow(this.a,this.N());this.check(this.A,"A");this.u=this.computeU(this.A.toString(16),e);this.S=this.computeSessionKey(this.k,a,this.u,this.a,this.B);this.check(this.S,"S");var d=this.toHex(this.A);this.M1str=this.H(d+e+this.toHex(this.S));this.check(this.M1str,"M1str");while(this.M1str.substring(0,1)==="0"){this.M1str=this.M1str.substring(1)}this.state=this.STEP_2;return{A:d,M1:this.M1str}};SRP6JavascriptClientSession.prototype.step3=function(a){this.check(a);if(this.state!==this.STEP_2){throw new Error("IllegalStateException State violation: Session must be in STEP_2 state")}var b=this.H(this.toHex(this.A)+this.M1str+this.toHex(this.S));while(b.substring(0,1)==="0"){b=b.substring(1)}if(""+b!==""+a){throw new Error("SRP6Exception Bad server credentials")}this.state=this.STEP_3;return true};